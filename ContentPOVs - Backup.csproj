<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>netstandard2.1</TargetFramework>
    <AssemblyName>com.gingerphoenix10.povs</AssemblyName>
    <Product>ContentPOVs</Product>
    <Version>1.0.0</Version>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <LangVersion>latest</LangVersion>
    <RestoreAdditionalProjectSources>
      https://api.nuget.org/v3/index.json;
      https://nuget.bepinex.dev/v3/index.json;
      https://nuget.samboy.dev/v3/index.json
    </RestoreAdditionalProjectSources>
    <RootNamespace>ContentPOVs</RootNamespace>
  </PropertyGroup>

  <!-- Package References - Standard Libraries -->
  <ItemGroup>
    <PackageReference Include="BepInEx.Analyzers" Version="1.*" PrivateAssets="all" />
    <PackageReference Include="BepInEx.Core" Version="5.*" />
    <PackageReference Include="BepInEx.PluginInfoProps" Version="2.*" />
    <PackageReference Include="UnityEngine.Modules" Version="2022.3.10" IncludeAssets="compile" />
  </ItemGroup>

  <!-- .NET Framework References -->
  <ItemGroup Condition="'$(TargetFramework.TrimEnd(`0123456789`))' == 'net'">
    <PackageReference Include="Microsoft.NETFramework.ReferenceAssemblies" Version="1.0.2" PrivateAssets="all" />
  </ItemGroup>

  <!-- Local References in ./libs folder -->
  <ItemGroup>
    <Reference Include="Assembly-CSharp">
      <HintPath>..\Content Warning_Data\Managed\Assembly-CSharp.dll</HintPath>
    </Reference>
    <Reference Include="com.rlabrecque.steamworks.net">
      <HintPath>..\Content Warning_Data\Managed\com.rlabrecque.steamworks.net.dll</HintPath>
    </Reference>
    <Reference Include="MyceliumNetworkingForCW">
      <HintPath>.\libs\MyceliumNetworking\MyceliumNetworkingForCW.dll</HintPath>
    </Reference>
    <Reference Include="Photon3Unity3D">
      <HintPath>.\libs\Photon3Unity3D.dll</HintPath>
    </Reference>
    <Reference Include="PhotonRealtime">
      <HintPath>.\libs\PhotonRealtime.dll</HintPath>
    </Reference>
    <Reference Include="PhotonUnityNetworking">
      <HintPath>.\libs\PhotonUnityNetworking.dll</HintPath>
    </Reference>
    <Reference Include="RedstoneWizard08.ConfigurableWarning">
      <HintPath>.\libs\RedstoneWizard08.ConfigurableWarning.dll</HintPath>
    </Reference>
    <Reference Include="ShopUtils">
      <HintPath>.\libs\ShopUtils.dll</HintPath>
    </Reference>
    <Reference Include="Sirenix.Serialization">
      <HintPath>.\libs\Sirenix.Serialization.dll</HintPath>
    </Reference>
    <Reference Include="Unity.TextMeshPro">
      <HintPath>.\libs\Unity.TextMeshPro.dll</HintPath>
    </Reference>
    <Reference Include="Zorro.Core.Runtime">
      <HintPath>.\libs\Zorro.Core.Runtime.dll</HintPath>
    </Reference>
    <Reference Include="Zorro.Settings.Runtime">
      <HintPath>.\libs\Zorro.Settings.Runtime.dll</HintPath>
    </Reference>
  </ItemGroup>

  <!-- CI-Specific References -->
  <ItemGroup Condition="$(CI) == 'true'">
    <PackageReference Include="ContentWarning.GameLibs.Steam" Version="*-*" PrivateAssets="all" />
  </ItemGroup>

  <Target Name="PostBuild" AfterTargets="PostBuildEvent">
    <Exec Command="@Echo Off&#xD;&#xA;SETLOCAL EnableExtensions&#xD;&#xA;set EXE=Content Warning.exe&#xD;&#xA;Set &quot;DIR=&quot;&#xD;&#xA;For /F &quot;Tokens=1,2*&quot; %25%25A In ('Reg Query HKCU\SOFTWARE\Valve\Steam') Do (&#xD;&#xA;    If &quot;%25%25A&quot; Equ &quot;SteamPath&quot; Set &quot;DIR=%25%25C\steamapps\common\Content Warning\&quot;)&#xD;&#xA;If Not Defined DIR echo Couldn't find Content Warning. Cannot auto-install mod. &amp;&amp; Exit/B&#xD;&#xA;If Not Exist &quot;%25DIR%25&quot; echo Couldn't find Content Warning. Cannot auto-install mod. &amp;&amp; Exit/B&#xD;&#xA;set MODS=%25DIR%25\BepInEx\Plugins&#xD;&#xA;set DLL=com.gingerphoenix10.POVs.dll&#xD;&#xA;FOR /F %25%25x IN (&quot;%25EXE%25&quot;) do set EXE_=%25%25x&#xD;&#xA;FOR /F %25%25x IN ('tasklist /NH /FI &quot;IMAGENAME eq %25EXE%25&quot;') DO IF %25%25x == %25EXE_%25 (&#xD;&#xA;  taskkill /F /IM &quot;%25EXE%25&quot;&#xD;&#xA;)&#xD;&#xA;ping 127.0.0.1 -n 2 &gt; nul&#xD;&#xA;if exist &quot;%25MODS%25\%25DLL%25&quot; (&#xD;&#xA;  del &quot;%25MODS%25\%25DLL%25&quot;&#xD;&#xA;)&#xD;&#xA;ping 127.0.0.1 -n 2 &gt; nul&#xD;&#xA;copy &quot;$(TargetPath)&quot; &quot;%25MODS%25&quot;&#xD;&#xA;:loop&#xD;&#xA;if exist &quot;%25MODS%25\%25DLL%25&quot; (&#xD;&#xA;  cd &quot;%25DIR%25&quot;&#xD;&#xA;  ping 127.0.0.1 -n 2 &gt; nul&#xD;&#xA;  start &quot;&quot; /b &quot;%25EXE%25&quot;&#xD;&#xA;  exit /b 0&#xD;&#xA;) else (&#xD;&#xA;  goto loop&#xD;&#xA;)" />
  </Target>
</Project>
